{"name":"Hdr","tagline":"NTU VFX Project 1","body":"## 台灣大學 數位視覺效果 Project 1 High Dynamic Range Imaging\r\n\r\n**R03631012** 黃揚文 **R03631014** 徐嘉君\r\n\r\n因為相機所能能拍攝到明暗亮度範圍有限，不能拍攝到如我們人眼所看到的光線範圍。HDR ( High Dynamic Range Imaging ) 可以藉由不同曝光時間的相片來生成具有高動態範圍的影像。使得影像更接近我們人眼實際看到的東西。本專案為台灣大學數位視覺效果課程之HDR課題練習。\r\n\r\n### 使用相機\r\n本專題使用的相機為Nikon D3200，鏡頭為kit鏡 (AF-S NIKKOR 18-55mm 1:3.5-5.6G)\r\n\r\n### 開發環境\r\nVisual Studio 2013 Pro\r\nQt 5.4\r\n\r\n### 實作方法\r\n#### 事前校準\r\n雖然HDR的照片因為相機在同樣地點、情況下拍攝不同的多組曝光時間不同的照片，但因為仍會有手震和快門造成的些微動作，所以藉由Alignment可以將這些些微的震動經由稍微移動照片來消除。本專題採用的為上課介紹的Median Threshold Bitmap作校準，本演算法利用影像金字塔的方式(每層圖片都為上一層的四倍)從最小的開始比對，在九宮格內做移動如下圖所示，累計個方向的誤差選擇最小的方向移動之。\r\n\r\n| (-1, -1) | (0, -1) | (1, -1) |\r\n| --- | --- | --- |\r\n| **(-1, 0)** | **(0, 0)** | **(1, 0)** |\r\n| **(-1, 1 )** | **(0, 1)** | **(1, 1)** |\r\n\r\n#### 建立HDR影像\r\n在建立HDR影像以前利用**exif**這個函式庫直接讀取由相機拍出的JPG影像的曝光時間。本專題建立HDR影像的方法為上課介紹的Debevec方法，並且將論文的gsolve為基底轉成C++程式碼，用OpenCV提供的 ``cv::solve()`` SVD解 Ax = b方程解，得到響應曲線。最後再將輸入的所有影像的每個點帶入該曲線並乘上權重，最後得到radiance map。\r\n\r\n#### Tone Mapping\r\n因為HDR影像不一定為一般影像中0-255的範圍區間，因此需要轉換成一般圖片格式，許多演算法都要求必須先算出其亮度(intensity)，再算出答案。本專題採用兩種方法做試驗，第一個為Durand，另一個為Reinhard\r\n\r\n**Reinhard**\r\n\r\nReinhard先計算了該HDR影像的亮度平均，再套用自定義的白平衡修正，最後再將修正過後的與亮度相除得到一個scale factor，最後再將此矩陣與HDR影像相乘即可得到答案。\r\n\r\n**Durand**\r\n\r\nDurand在其個人網頁中有很詳細的步驟\r\n```\r\ninput intensity= 0.2126 * R + 0.7152 * G + 0.0722 * B\r\nr=R/(input intensity), g=G/(input intensity), B=B/(input intensity)\r\nlog(base)=Bilateral(log(input intensity))\r\nlog(detail)=log(input intensity)-log(base)\r\nlog (output intensity)=log(base)*compressionfactor+log(detail)\r\noutput = r*log_absolute_scale*10^(log(output intensity))\r\n\r\n//Parameters\r\ncompressionfactor = (log(5) / log(10.0)) /(max(log(base)) - min(log(base)))\r\nlog_absolute_scale = 1.0 / pow(10.0, compression_factor * max_log);\r\n```\r\n其中的雙線濾波器我們使用的是OpenCV提供的雙線濾波，並使用作者提供的參數做設定取出圖片的細節，在計算過顏色後再將細節還原回去。\r\n\r\n#### 結果\r\n以下為利用本專題撰寫程式之結果\r\n\r\n| Reinhard | Durand |\r\n| --- | --- |\r\n| ![Imgur](http://i.imgur.com/Ts1DPbE.png) | ![Imgur](http://i.imgur.com/Q9jUrCy.png) |\r\n| ![Imgur](http://i.imgur.com/pUELvaF.png) | ![Imgur](http://i.imgur.com/Q00P7Ov.png) |\r\n\r\n第一張圖由於日光燈的資訊在下面原始十張圖片中都未有太大變動，因此在重建HDR影像時出現嚴重破損，也對影像重建帶來一定量的影響\r\n\r\n**原始檔案**\r\n\r\n1\r\n\r\n| ![Imgur](http://i.imgur.com/T9zHyL5.jpg) | ![Imgur](http://i.imgur.com/LeJf3Dz.jpg) | ![Imgur](http://i.imgur.com/OApzzB6.jpg) | ![Imgur](http://i.imgur.com/jWX3vLr.jpg) | ![Imgur](http://i.imgur.com/WLQSyea.jpg) |\r\n| --- | --- | --- | --- | --- |\r\n| ![Imgur](http://i.imgur.com/YA2D62R.jpg) | ![Imgur](http://i.imgur.com/siLNZP7.jpg) | ![Imgur](http://i.imgur.com/cFKz4VE.jpg) | ![Imgur](http://i.imgur.com/WkJrgsI.jpg) | ![Imgur](http://i.imgur.com/XpBB6xB.jpg) |\r\n\r\n2\r\n\r\n| ![Imgur](http://i.imgur.com/GtLbTau.jpg) | ![Imgur](http://i.imgur.com/8kxcrTO.jpg) | ![Imgur](http://i.imgur.com/uTFVs11.jpg) | ![Imgur](http://i.imgur.com/WK3M6FE.jpg) | ![Imgur](http://i.imgur.com/LTsV7PB.jpg) |\r\n| --- | --- | --- | --- | --- |\r\n| ![Imgur](http://i.imgur.com/xCgPtw3.jpg) | ![Imgur](http://i.imgur.com/RbsUS8u.jpg) | ![Imgur](http://i.imgur.com/ShGbbke.jpg) | ![Imgur](http://i.imgur.com/V1agGds.jpg) | ![Imgur](http://i.imgur.com/h52cq08.jpg) |\r\n\r\n### 作者\r\n黃揚文 (@KKyang)\r\n徐嘉君 (@Chia-ChunHsu)\r\n\r\n### Support or Contact\r\n可以利用Github提供的issues功能提供我們意見，謝謝!\r\n\r\n### Reference\r\n1. Paul E. Debevec, Jitendra Malik, Recovering High Dynamic Range Radiance Maps from Photographs, SIGGRAPH 1997\r\n2. Fredo Durand, Julie Dorsey, Fast Bilateral Filtering for the Display of High Dynamic Range Images, SIGGRAPH 2002\r\n3. Reinhard, E., Stark, M., Shirley, P., and Ferwerda, J.A. Photographic tone reproduction for digital images, SIGGRAPH 2002\r\n4. 課程講義(MTB, HDR, Tone mapping)","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}